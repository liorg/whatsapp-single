[supervisord]
nodaemon=false
logfile=/var/log/supervisord.log
logfile_maxbytes=10MB
loglevel=info

[unix_http_server]
file=/var/run/supervisor.sock

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

[supervisorctl]
serverurl=unix:///var/run/supervisor.sock

; ── Redis ────────────────────────────────────────────────────────────────────
[program:redis]
command=redis-server --appendonly yes --maxmemory 256mb --maxmemory-policy allkeys-lru
autostart=true
autorestart=true
priority=10
stdout_logfile=/var/log/redis.log
stderr_logfile=/var/log/redis.log
stdout_logfile_maxbytes=5MB

; ── Baileys (Node.js) ────────────────────────────────────────────────────────
[program:baileys]
command=node /app/baileys/src/index.js
autostart=true
autorestart=true
priority=20
startsecs=10
startretries=5
stdout_logfile=/var/log/baileys.log
stderr_logfile=/var/log/baileys.log
stdout_logfile_maxbytes=5MB
environment=PORT="3001",REDIS_URL="redis://localhost:6379",REDIS_QUEUE_KEY="whatsapp:messages:incoming",NODE_ENV="production",LOG_LEVEL="warn"

; ── FastAPI (Python) ─────────────────────────────────────────────────────────
[program:fastapi]
command=/opt/venv/bin/uvicorn app.main:app --host 0.0.0.0 --port 8000
directory=/app/fastapi
autostart=true
autorestart=true
priority=30
startsecs=5
stdout_logfile=/var/log/fastapi.log
stderr_logfile=/var/log/fastapi.log
stdout_logfile_maxbytes=5MB
environment=BAILEYS_URL="http://localhost:3001",REDIS_URL="redis://localhost:6379",REDIS_QUEUE_KEY="whatsapp:messages:incoming"
